<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph</title>
    <link rel="stylesheet" href="graph.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

</head>

<body>
    <div class="workspace">
        <div id="canvass">
            <div class="temp">
                <span>Temperature graph</span>
                <canvas id="myChart" width="800" height="400"></canvas> </canvas>
            </div>
            <div class="temp">
                <span>Trigger graph</span>
                <canvas id="myChart2" width="800" height="400"></canvas> </canvas>
            </div>
        </div>
        <div class="drop">
            <span>Select session</span>
            <div class="options" id="options">
                <div class="inputBlock">
                    <span>Show data from</span>
                    <input type="date" id="time1">
                    <button id="seeSession">See sessions</button>
                </div>
                <div class="inputBlock">
                    <span>Session</span>
                    <input type="number" id="session" list="sessions-list" placeholder="session number">
                    <datalist id="sessions-list"></datalist>
                    <button id="lastSession">Last session</button>
                </div>
                <button id="confirm">Confirm</button>

            </div>

        </div>

    </div>
    <button id="tester">Return to Tester</button>

    <script>
        document.querySelector(".drop").addEventListener("click", function (event) {
            this.querySelector("div").style.display = "flex";
            event.stopPropagation();
        });

        window.addEventListener("click", function () {
            document.querySelector(".drop div").style.display = "none";
        });

        document.getElementById("lastSession").addEventListener("click", async () => {
            const response = await fetch("/getLastSession", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
            });
            const lastSession = await response.json();
            document.getElementById("session").value = lastSession.lastSession;

        })

        document.getElementById("seeSession").addEventListener("click", function () {
            const dateInput = document.getElementById("time1");
            const date = dateInput.value;
            if (date) {
                fetch("/getSessions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ date: date })
                })
                    .then(response => response.json())
                    .then(sessions => {
                        const sessionsList = document.getElementById("sessions-list");
                        sessionsList.innerHTML = "";
                        sessions.forEach(session => {
                            const option = document.createElement("option");
                            option.value = session;
                            sessionsList.appendChild(option);
                        });
                    })
                    .catch(error => console.error("Ошибка:", error));
            }
        });

        document.getElementById("confirm").addEventListener("click", function () {
            const sessionValue = document.getElementById("session").value;
            if (confirm(`Are you sure you want to see ${sessionValue} session?`)) {
                fetch("/confirmSession", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ session: sessionValue })
                })
                    .then(response => response.json())
                    .then(data => createGraph(data))
                    .catch(error => console.error("Error:", error));
            }
        });
    </script>
</body>

</html>